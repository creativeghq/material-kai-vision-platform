"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[338],{9354:function(e,t,a){a.d(t,{Z:function(){return r}});let r=(0,a(1134).Z)("database",[["ellipse",{cx:"12",cy:"5",rx:"9",ry:"3",key:"msslwz"}],["path",{d:"M3 5V19A9 3 0 0 0 21 19V5",key:"1wlel7"}],["path",{d:"M3 12A9 3 0 0 0 21 12",key:"mv7ke4"}]])},8030:function(e,t,a){a.d(t,{Z:function(){return r}});let r=(0,a(1134).Z)("lightbulb",[["path",{d:"M15 14c.2-1 .7-1.7 1.5-2.5 1-.9 1.5-2.2 1.5-3.5A6 6 0 0 0 6 8c0 1 .2 2.2 1.5 3.5.7.7 1.3 1.5 1.5 2.5",key:"1gvzjb"}],["path",{d:"M9 18h6",key:"x1upvd"}],["path",{d:"M10 22h4",key:"ceow96"}]])},6522:function(e,t,a){a.d(t,{K:function(){return c}});var r=a(3214);class i extends Error{constructor(e,t=500,a=!0,r){super(e),this.name=this.constructor.name,this.statusCode=t,this.isOperational=a,this.context=r,Error.captureStackTrace(this,this.constructor)}}class s extends i{constructor(e,t){super(e,400,!0,t)}}class n extends i{constructor(e="Service temporarily unavailable",t){super(e,503,!0,t)}}class o{static handleError(e,t){if(e instanceof i)return t?new i(e.message,e.statusCode,e.isOperational,{...e.context,...t}):e;if(e&&"object"==typeof e&&"response"in e){var a;let r=e.response.status;return new i((null===(a=e.response.data)||void 0===a?void 0:a.message)||e.message||"HTTP request failed",r,!0,{...t,httpStatus:r,responseData:e.response.data})}return e&&"object"==typeof e&&"request"in e?new n("Network error - service unavailable",{...t,errorCode:e.code,errorType:"network"}):e&&"object"==typeof e&&"name"in e&&"ZodError"===e.name&&"errors"in e?new s("Validation failed",{...t,validationErrors:e.errors}):new i(e.message||"An unexpected error occurred",500,!1,{...t,originalError:e.name,stack:e.stack})}static logError(e){let t={message:e.message,statusCode:e.statusCode,context:e.context,stack:e.stack,timestamp:new Date().toISOString()};e.statusCode>=500?console.error("[ERROR]",t):e.statusCode>=400?console.warn("[WARN]",t):console.info("[INFO]",t)}static isOperationalError(e){return e instanceof i&&e.isOperational}static createErrorResponse(e){return{error:{message:e.message,code:e.name,statusCode:e.statusCode,...!1}}}static wrapAsync(e){return async function(){for(var t=arguments.length,a=Array(t),r=0;r<t;r++)a[r]=arguments[r];try{return await e(...a)}catch(t){let e=o.handleError(t);throw o.logError(e),e}}}}class c{static async search(e){try{let{data:{user:t}}=await r.supabase.auth.getUser(),{data:a,error:i}=await r.supabase.functions.invoke("enhanced-rag-search",{body:{...e,userId:null==t?void 0:t.id}});if(i)throw i;return a}catch(t){throw o.createValidationError("Enhanced RAG search failed",{query:e.query,searchType:e.searchType,originalError:t.message})}}static async getMaterialKnowledge(e){try{let{data:t,error:a}=await r.supabase.from("material_knowledge_extraction").select("*").eq("material_id",e).eq("validation_status","approved").order("confidence_score",{ascending:!1});if(a)throw a;return t.map(e=>({id:e.id,materialId:e.material_id,extractionType:e.extraction_type,extractedKnowledge:e.extracted_knowledge,confidence:e.confidence_score,extractionContext:e.extraction_context||{},sourceFields:e.source_fields||[],validationStatus:e.validation_status,validatedBy:e.validated_by,validationNotes:e.validation_notes,createdAt:e.created_at,updatedAt:e.updated_at}))}catch(t){throw o.createValidationError("Material knowledge fetch failed",{materialId:e,originalError:t.message})}}static async addKnowledgeEntry(e){try{let{data:{user:t}}=await r.supabase.auth.getUser();if(!t)throw Error("User not authenticated");let{data:a,error:i}=await r.supabase.functions.invoke("analyze-knowledge-content",{body:{title:e.title,content:e.content,contentType:e.contentType}});i&&console.warn("Knowledge analysis failed, proceeding without ML enhancement:",i);let{data:s,error:n}=await r.supabase.from("enhanced_knowledge_base").insert({title:e.title,content:e.content,content_type:e.contentType||"article",source_url:e.sourceUrl,pdf_url:e.pdfUrl,material_ids:e.materialIds||[],material_categories:e.materialCategories||[],semantic_tags:e.semanticTags||[],language:e.language||"en",reading_level:e.readingLevel,technical_complexity:e.technicalComplexity,openai_embedding:null==a?void 0:a.openai_embedding,huggingface_embedding:null==a?void 0:a.huggingface_embedding,custom_embedding:null==a?void 0:a.custom_embedding,confidence_scores:null==a?void 0:a.confidence_scores,search_keywords:null==a?void 0:a.search_keywords,created_by:t.id,last_modified_by:t.id,status:"draft"}).select().single();if(n)throw n;return s}catch(t){throw o.createValidationError("Knowledge entry addition failed",{entryTitle:e.title,originalError:t.message})}}static async getKnowledgeRelationships(e){try{let{data:t,error:a}=await r.supabase.from("knowledge_relationships").select("*").or("source_id.eq.".concat(e,",target_id.eq.").concat(e)).eq("validation_status","approved").order("confidence_score",{ascending:!1});if(a)throw a;return t.map(e=>({id:e.id,sourceId:e.source_id,targetId:e.target_id,relationshipType:e.relationship_type,confidence:e.confidence_score,relationshipStrength:e.relationship_strength,relationshipContext:e.relationship_context,bidirectional:e.bidirectional,sourceType:e.source_type,validationStatus:e.validation_status,validatedBy:e.validated_by,createdAt:e.created_at,updatedAt:e.updated_at}))}catch(t){throw o.createValidationError("Knowledge relationships fetch failed",{entryId:e,originalError:t.message})}}static async getQueryHistory(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:20;try{let{data:{user:t}}=await r.supabase.auth.getUser();if(!t)throw Error("User not authenticated");let{data:a,error:i}=await r.supabase.from("query_intelligence").select("*").eq("user_id",t.id).order("created_at",{ascending:!1}).limit(e);if(i)throw i;return a.map(e=>({id:e.id,userId:e.user_id,originalQuery:e.original_query,processedQuery:e.processed_query,queryIntent:e.query_intent,queryType:e.query_type,entitiesDetected:e.entities_detected||{},userContext:e.user_context||{},sessionContext:e.session_context||{},projectContext:e.project_context||{},resultsReturned:e.results_returned,userSatisfaction:e.user_satisfaction,clickedResults:e.clicked_results||[],createdAt:e.created_at}))}catch(e){throw o.createValidationError("Query history fetch failed",{originalError:e.message})}}static async provideFeedback(e,t){try{let{data:{user:a}}=await r.supabase.auth.getUser();if(!a)throw Error("User not authenticated");let{error:i}=await r.supabase.from("query_intelligence").update({user_satisfaction:t.satisfaction,clicked_results:t.clickedResults}).eq("id",e).eq("user_id",a.id);if(i)throw i;return(t.followUpQuery||t.notes)&&await r.supabase.from("search_analytics").insert({user_id:a.id,query_text:t.followUpQuery||"feedback",satisfaction_rating:t.satisfaction}),{success:!0}}catch(e){throw o.createValidationError("Feedback submission failed",{satisfaction:t.satisfaction,originalError:e.message})}}static async getSearchAnalytics(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"30 days";try{let{data:{user:t}}=await r.supabase.auth.getUser();if(!t)throw Error("User not authenticated");let a=new Date;a.setDate(a.getDate()-parseInt(e.split(" ")[0]));let{data:i,error:s}=await r.supabase.from("search_analytics").select("*").eq("user_id",t.id).gte("created_at",a.toISOString()).order("created_at",{ascending:!1});if(s)throw s;let n=i.length,o=i.filter(e=>e.satisfaction_rating).reduce((e,t)=>e+t.satisfaction_rating,0)/i.filter(e=>e.satisfaction_rating).length||0,c=i.reduce((e,t)=>e+(t.response_time_ms||0),0)/i.length||0,d=i.reduce((e,t)=>(e[t.query_text]=(e[t.query_text]||0)+1,e),{});return{totalSearches:n,avgSatisfaction:Math.round(100*o)/100,avgResponseTime:Math.round(c),topQueries:Object.entries(d).sort((e,t)=>{let[,a]=e,[,r]=t;return r-a}).slice(0,10).map(e=>{let[t,a]=e;return{query:t,count:a}}),searchHistory:i.slice(0,50)}}catch(e){throw o.createValidationError("Search analytics fetch failed",{originalError:e.message})}}static async extractMaterialKnowledge(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];try{let{data:{user:a}}=await r.supabase.auth.getUser();if(!a)throw Error("User not authenticated");if(!t){let{data:t}=await r.supabase.from("material_knowledge_extraction").select("id").eq("material_id",e).gte("created_at",new Date(Date.now()-6048e5).toISOString()).limit(1);if(t&&t.length>0)return console.log("Material knowledge already extracted recently"),{success:!0,message:"Knowledge already extracted recently"}}let{data:i,error:s}=await r.supabase.functions.invoke("extract-material-knowledge",{body:{materialId:e,userId:a.id,forceReextraction:t}});if(s)throw s;return i}catch(t){throw o.createValidationError("Material knowledge extraction failed",{materialId:e,originalError:t.message})}}static async validateKnowledge(e,t,a){try{let{data:{user:i}}=await r.supabase.auth.getUser();if(!i)throw Error("User not authenticated");let{error:s}=await r.supabase.from("material_knowledge_extraction").update({validation_status:t?"approved":"rejected",validated_by:i.id,validation_notes:a}).eq("id",e);if(s)throw s;return{success:!0}}catch(e){throw o.createValidationError("Knowledge validation failed",{originalError:e.message})}}}}}]);