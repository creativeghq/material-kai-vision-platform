(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[73],{6654:function(e,t,a){(window.__NEXT_P=window.__NEXT_P||[]).push(["/SearchHub",function(){return a(5056)}])},5928:function(e,t,a){"use strict";a.d(t,{Z:function(){return s}});let s=(0,a(1134).Z)("eye",[["path",{d:"M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0",key:"1nclc0"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]])},3432:function(e,t,a){"use strict";a.d(t,{Z:function(){return s}});let s=(0,a(1134).Z)("loader-circle",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]])},5056:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return G}});var s=a(5893),r=a(7294),i=a(1134);let n=(0,i.Z)("bot",[["path",{d:"M12 8V4H8",key:"hb8ula"}],["rect",{width:"16",height:"12",x:"4",y:"8",rx:"2",key:"enze0r"}],["path",{d:"M2 14h2",key:"vft8re"}],["path",{d:"M20 14h2",key:"4cs60a"}],["path",{d:"M15 13v2",key:"1xurst"}],["path",{d:"M9 13v2",key:"rq6x2g"}]]);var o=a(3058),l=a(8267);let c=(0,i.Z)("message-square",[["path",{d:"M22 17a2 2 0 0 1-2 2H6.828a2 2 0 0 0-1.414.586l-2.202 2.202A.71.71 0 0 1 2 21.286V5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2z",key:"18887p"}]]);var d=a(7089),u=a(9354),m=a(5928),h=a(8030),p=a(3432);let g=(0,i.Z)("file-image",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["circle",{cx:"10",cy:"12",r:"2",key:"737tya"}],["path",{d:"m20 17-1.296-1.296a2.41 2.41 0 0 0-3.408 0L9 22",key:"wt3hpn"}]]);var y=a(2553),f=a(2190);let x=(0,i.Z)("cpu",[["path",{d:"M12 20v2",key:"1lh1kg"}],["path",{d:"M12 2v2",key:"tus03m"}],["path",{d:"M17 20v2",key:"1rnc9c"}],["path",{d:"M17 2v2",key:"11trls"}],["path",{d:"M2 12h2",key:"1t8f8n"}],["path",{d:"M2 17h2",key:"7oei6x"}],["path",{d:"M2 7h2",key:"asdhe0"}],["path",{d:"M20 12h2",key:"1q8mjw"}],["path",{d:"M20 17h2",key:"1fpfkl"}],["path",{d:"M20 7h2",key:"1o8tra"}],["path",{d:"M7 20v2",key:"4gnj0m"}],["path",{d:"M7 2v2",key:"1i4yhu"}],["rect",{x:"4",y:"4",width:"16",height:"16",rx:"2",key:"1vbyd7"}],["rect",{x:"8",y:"8",width:"8",height:"8",rx:"1",key:"z9xiuo"}]]),v=(0,i.Z)("paperclip",[["path",{d:"m16 6-8.414 8.586a2 2 0 0 0 2.829 2.829l8.414-8.586a4 4 0 1 0-5.657-5.657l-8.379 8.551a6 6 0 1 0 8.485 8.485l8.379-8.551",key:"1miecu"}]]);var w=a(5264);let _=(0,i.Z)("send",[["path",{d:"M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z",key:"1ffxy3"}],["path",{d:"m21.854 2.147-10.94 10.939",key:"12cjpa"}]]);var b=a(6127),j=a(9346),k=a(8778),N=a(8860),A=a(4109),I=a(6731),D=a(3214),E=a(8977),S=a(6522),C=a(8186);class M extends C.e{async initialize(){if(!this.isInitialized)try{await this.doInitialize(),this.isInitialized=!0,console.log("Service ".concat(this.config.name," initialized successfully"))}catch(e){throw console.error("Failed to initialize service ".concat(this.config.name,":"),e),e}}async cleanup(){this.isInitialized=!1,this.rateLimitTracker.clear(),console.log("Service ".concat(this.config.name," cleaned up"))}getConfig(){return{...this.config}}updateConfig(e){this.config={...this.config,...e}}isReady(){return this.config.enabled&&this.isInitialized}async getHealth(){if(!this.isReady())return{status:"unhealthy",error:"Service not initialized or disabled"};try{let e=Date.now();await this.doHealthCheck();let t=Date.now()-e;return{status:"healthy",latency:t,lastCheck:new Date,uptime:Date.now()-this.startTime.getTime()}}catch(e){return{status:"unhealthy",error:e instanceof Error?e.message:"Unknown error",lastCheck:new Date}}}getMetrics(){let e=Date.now()-this.startTime.getTime(),t=this.requestCount>0?this.latencySum/this.requestCount:0;return{serviceName:this.config.name,environment:this.config.environment,uptime:e,requestCount:this.requestCount,errorCount:this.errorCount,averageLatency:t,lastActivity:this.lastActivity||void 0,rateLimitingEnabled:!!this.config.rateLimit}}async executeOperation(e,t){if(!this.isReady())throw Error("Service ".concat(this.config.name," is not ready"));let a=Date.now();this.requestCount++,this.lastActivity=new Date;try{await this.checkRateLimit(t);let s=await e(),r=Date.now()-a;return this.latencySum+=r,s}catch(e){throw this.errorCount++,this.handleError(e,t)}}handleError(e,t){let a=e instanceof Error?e.message:"Unknown error",s=Error("".concat(this.config.name," service error in ").concat(t,": ").concat(a));return console.error("Service ".concat(this.config.name," error:"),{context:t,error:a,stack:e instanceof Error?e.stack:void 0}),s}async checkRateLimit(e){if(!this.config.rateLimit||this.config.rateLimit.requestsPerMinute<=0)return;let t=Date.now(),a=this.config.rateLimit.requestsPerMinute,s=this.rateLimitTracker.get(e)||[];if((s=s.filter(e=>t-e<6e4)).length>=a){let e=6e4-(t-Math.min(...s));e>0&&await new Promise(t=>setTimeout(t,e))}s.push(t),this.rateLimitTracker.set(e,s)}constructor(e){super(),this.isInitialized=!1,this.startTime=new Date,this.requestCount=0,this.errorCount=0,this.latencySum=0,this.rateLimitTracker=new Map,this.config=e}}var R=a(3454);class U extends M{async doInitialize(){}async doHealthCheck(){if(!this.PROVIDERS.some(e=>e.available))throw Error("No AI providers available")}async processRequest(e){var t,a,s;let r=Date.now(),i=[],n=null!==(t=e.minimumScore)&&void 0!==t?t:this.DEFAULT_MIN_SCORE,o=null!==(a=e.maxRetries)&&void 0!==a?a:this.DEFAULT_MAX_RETRIES,l=this.PROVIDERS.filter(e=>e.available).sort((e,t)=>e.priority-t.priority),c=null,d=0,u=null;for(let t of l){if(i.length>=o)break;let a=Date.now();try{let s;switch(console.log("Attempting ".concat(e.type," with ").concat(t.name)),t.name){case"mivaa":s=await U.callMIVAA(e);break;case"claude":s=await U.callClaude(e);break;default:throw Error("Unknown provider: ".concat(t.name))}let r=U.validateResponse(s,e),o=Date.now()-a;if(i.push({provider:t.name,success:!0,score:r.score,processing_time_ms:o}),r.score>d&&(c=s,d=r.score,u=r),r.score>=n){console.log("".concat(t.name," met minimum score threshold: ").concat(r.score));break}console.log("".concat(t.name," score ").concat(r.score," below threshold ").concat(n,", trying next provider"))}catch(s){let e=Date.now()-a;i.push({provider:t.name,success:!1,error:s.message,processing_time_ms:e}),console.error("".concat(t.name," failed:"),s.message)}}let m=Date.now()-r;return c?{success:!0,data:c,provider:(null===(s=i.find(e=>e.score===d))||void 0===s?void 0:s.provider)||"unknown",attempts:i,final_score:d,validation:u,total_processing_time_ms:m}:{success:!1,data:null,provider:"none",attempts:i,final_score:0,validation:{score:0,issues:["All providers failed"]},total_processing_time_ms:m}}static async callHybridAnalysis(e){let{supabase:t}=await Promise.resolve().then(a.bind(a,3214)),{data:s,error:r}=await t.functions.invoke("hybrid-material-analysis",{body:e});if(r)throw Error("Hybrid analysis failed: ".concat(r.message));return s}static async callMIVAA(e){var t,a;let s;let r=R.env.NEXT_PUBLIC_MIVAA_GATEWAY_URL||"http://localhost:3000",i=R.env.NEXT_PUBLIC_MIVAA_API_KEY;if(!i)throw Error("MIVAA API key not configured");s="material-analysis"===e.type&&e.imageUrl?"llama_vision_analysis":"chat_completion";let n={messages:[{role:"system",content:U.getSystemPrompt(e.type)},{role:"user",content:e.prompt}],options:{max_tokens:2e3,temperature:.1}};e.imageUrl&&"llama_vision_analysis"===s&&(n.image_data=e.imageUrl,n.analysis_type="material_analysis");let o=await fetch("".concat(r,"/api/mivaa/gateway"),{method:"POST",headers:{Authorization:"Bearer ".concat(i),"Content-Type":"application/json","User-Agent":"Material-Kai-Vision-Platform-Client/1.0"},body:JSON.stringify({action:s,payload:n})});if(!o.ok){let e=await o.json().catch(()=>({}));throw Error("MIVAA gateway error: ".concat(o.status," - ").concat((null===(t=e.error)||void 0===t?void 0:t.message)||"Unknown error"))}let l=await o.json();if(!l.success)throw Error("MIVAA ".concat(s," error: ").concat((null===(a=l.error)||void 0===a?void 0:a.message)||"Unknown error"));return{text:l.data.content||l.data.response||l.data.analysis,raw_response:l.data,provider:"mivaa",action:s}}static async callClaude(e){throw Error("Use callHybridAnalysis instead for client-side calls")}static getSystemPrompt(e){switch(e){case"material-analysis":return'You are an expert materials scientist. Analyze materials and respond with valid JSON containing:\n        {\n          "material_name": "specific material name",\n          "category": "one of: metals, plastics, ceramics, composites, textiles, wood, glass, rubber, concrete, other",\n          "confidence": 0.0-1.0,\n          "properties": {object with density, strength, thermal properties, etc.},\n          "chemical_composition": {object with chemical info},\n          "safety_considerations": [array of safety notes],\n          "standards": [array of relevant standards]\n        }';case"3d-generation":return'You are an interior design expert. Parse requests and respond with JSON:\n        {\n          "room_type": "living room, kitchen, bedroom, etc.",\n          "style": "modern, Swedish, industrial, etc.",\n          "materials": [array of mentioned materials],\n          "features": [array of furniture/features],\n          "layout": "layout specifications",\n          "enhanced_prompt": "detailed prompt for image generation"\n        }';case"text-processing":return"You are an expert in document analysis and text extraction. Provide clear, structured responses.";default:return"You are a helpful AI assistant. Provide accurate and detailed responses."}}static validateResponse(e,t){let a=e&&(e.text||e.raw_response||e.image_url||Object.keys(e).length>0);return{score:(null==e?void 0:e.error)||(null==e?void 0:e.status)==="error"?.1:a?.9:.3,confidence:a?.8:.2,reasoning:a?"Response contains content":"Response is empty or invalid",issues:a?[]:["Empty or invalid response"],suggestions:a?[]:["Retry with different parameters"]}}static async checkProviderAvailability(){try{let{supabase:e}=await Promise.resolve().then(a.bind(a,3214)),{data:t,error:s}=await e.functions.invoke("hybrid-material-analysis",{body:{check_availability:!0}});if(s)return{openai:!1,claude:!1};return t.availability||{openai:!1,claude:!1}}catch(e){return{openai:!1,claude:!1}}}constructor(...e){super(...e),this.PROVIDERS=[{name:"mivaa",priority:1,available:!0},{name:"claude",priority:2,available:!0}],this.DEFAULT_MIN_SCORE=.7,this.DEFAULT_MAX_RETRIES=2}}let T={name:"HybridAIService",version:"1.0.0",environment:"development",enabled:!0,providers:[{name:"openai",priority:1,available:!0},{name:"claude",priority:2,available:!0}],defaultMinScore:.7,defaultMaxRetries:2,enableValidation:!0},q=null;U.processRequest=async e=>(q||(q=new U(T),await q.initialize()),q.processRequest(e));class P{static async generate3D(e){try{let{data:{user:t}}=await D.supabase.auth.getUser();if(!t)throw Error("User not authenticated");console.log("Calling edge function with request:",{user_id:t.id,prompt:e.prompt,room_type:e.room_type,style:e.style,specific_materials:e.specific_materials});let{data:a,error:s}=await D.supabase.functions.invoke("crewai-3d-generation",{body:{user_id:t.id,prompt:e.prompt,room_type:e.room_type,style:e.style,specific_materials:e.specific_materials}});if(console.log("Edge function response:",{data:a,error:s}),s)throw console.error("Supabase functions error:",s),Error("Failed to send a request to the Edge Function: ".concat(s.message));if(a&&!a.success&&a.error)throw Error("".concat(a.error,": ").concat(a.details||"Unknown error"));return a}catch(e){throw console.error("3D generation error:",e),e}}static async getUserGenerations(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:20;try{let{data:t,error:a}=await D.supabase.from("generation_3d").select("*").order("created_at",{ascending:!1}).limit(e);if(a)throw Error("Failed to fetch generations: ".concat(a.message));return t||[]}catch(e){throw console.error("Error fetching user generations:",e),e}}static async getGeneration(e){try{let{data:t,error:a}=await D.supabase.from("generation_3d").select("*").eq("id",e).single();if(a){if("PGRST116"===a.code)return null;throw Error("Failed to fetch generation: ".concat(a.message))}return t}catch(e){throw console.error("Error fetching generation:",e),e}}static async getGenerationAnalytics(){arguments.length>0&&void 0!==arguments[0]&&arguments[0];try{let{data:{user:e}}=await D.supabase.auth.getUser();if(!e)throw Error("User not authenticated");let{data:t,error:a}=await D.supabase.from("analytics_events").select("event_data, created_at").eq("user_id",e.id).eq("event_type","3d_generation_completed").gte("created_at",new Date(Date.now()-2592e6).toISOString()).order("created_at",{ascending:!1});if(a)throw Error("Failed to fetch analytics: ".concat(a.message));let s={total_generations:(null==t?void 0:t.length)||0,avg_processing_time:0,avg_quality_score:0,popular_room_types:{},popular_styles:{},material_usage:{}},r=0,i=0,n=0;return null==t||t.forEach(e=>{let t=e.event_data;t.processing_time_ms&&(r+=t.processing_time_ms),t.quality_score&&(i+=t.quality_score,n++),t.room_type&&(s.popular_room_types[t.room_type]=(s.popular_room_types[t.room_type]||0)+1),t.style&&(s.popular_styles[t.style]=(s.popular_styles[t.style]||0)+1)}),s.avg_processing_time=s.total_generations>0?r/s.total_generations:0,s.avg_quality_score=n>0?i/n:0,s}catch(e){throw console.error("Error fetching generation analytics:",e),e}}static async searchGenerations(e,t,a){try{let s=D.supabase.from("generation_3d").select("*").order("created_at",{ascending:!1});e&&(s=s.or("prompt.ilike.%".concat(e,"%,materials_used.cs.{").concat(e,"}"))),t&&(s=s.eq("room_type",t)),a&&(s=s.eq("style",a));let{data:r,error:i}=await s.limit(50);if(i)throw Error("Search failed: ".concat(i.message));return r||[]}catch(e){throw console.error("Error searching generations:",e),e}}}let z=e=>{let{onMaterialSelect:t,onNavigateToMoodboard:a,onNavigateTo3D:i}=e,{toast:C}=(0,I.pm)(),[M,R]=(0,r.useState)([]),[T,q]=(0,r.useState)(""),[z,G]=(0,r.useState)(!1),[F]=(0,r.useState)(()=>crypto.randomUUID()),[Z,V]=(0,r.useState)([]),[L,O]=(0,r.useState)(!1),[H,B]=(0,r.useState)({primary:"claude",fallback:"openai",temperature:.7,maxTokens:4e3,useRAG:!0,use3DGeneration:!0,enableRAG:!0,enable3DGeneration:!0,useVisualSearch:!0,enableVisualSearch:!0}),[K,Y]=(0,r.useState)("text"),[W,X]=(0,r.useState)(null),J=(0,r.useRef)(null),Q=(0,r.useRef)(null);(0,r.useEffect)(()=>{R([{id:crypto.randomUUID(),role:"assistant",content:"\uD83D\uDC4B Hello! I'm your AI material research assistant powered by Material Agent Orchestrator. I can help you:\n\n• Search and analyze materials from our PDF knowledge base\n• Find materials based on specific properties or applications\n• Generate design suggestions and 3D concepts\n• Cross-reference materials with projects and mood boards\n\nWhat would you like to explore today?",timestamp:new Date,suggestions:["Find sustainable materials for modern interiors","Search for acoustic materials with high performance","Show me trending colors and textures for 2024","Find materials suitable for outdoor applications"]}])},[]),(0,r.useEffect)(()=>{var e;null===(e=J.current)||void 0===e||e.scrollIntoView({behavior:"smooth"})},[M]);let $=e=>{V(t=>{let a=t.find(t=>t.id===e);return(null==a?void 0:a.url)&&URL.revokeObjectURL(a.url),t.filter(t=>t.id!==e)})},ee=async()=>{if(!T.trim()||z)return;let e={id:crypto.randomUUID(),role:"user",content:T,timestamp:new Date,...Z.length>0&&{attachments:[...Z]}};R(t=>[...t,e]),q(""),G(!0);try{var t,a,s,r,i,n,o,l,c,d,u,m,h,p;let{data:{session:e}}=await D.supabase.auth.getSession();if(!e)throw Error("Please sign in to use the AI assistant");console.log("=== Enhanced Material Agent Integration ==="),console.log("1. File attachments:",Z.length>0?"".concat(Z.length," files attached"):"No files"),console.log("2. Hybrid model config:",H),console.log("3. RAG enabled:",H.useRAG),console.log("4. 3D generation enabled:",H.use3DGeneration),console.log("5. Session context:",F),console.log("6. User input:",{length:T.length,hasAttachments:Z.length>0}),console.log("=====================================");let g={previousMessages:M.slice(-5),userPreferences:{includeDesignSuggestions:!0,includeMaterialProperties:!0,includeApplicationExamples:!0,use3DGeneration:H.use3DGeneration,useRAG:H.useRAG,useVisualSearch:H.useVisualSearch},hybridModelConfig:H,attachments:Z.map(e=>({id:e.id,name:e.name,type:e.type,size:e.size,url:e.url||""}))},y=null;if(H.useRAG&&T.trim())try{console.log("\uD83E\uDDE0 Performing RAG search...");let e=await S.K.search({query:T,context:{projectType:"interior_design",roomType:"general",materialCategories:["all"]},searchType:"hybrid",maxResults:5,includeRealTime:!1});e.success&&e.results&&(y={knowledgeResults:(e.results.knowledgeBase||[]).map(e=>({id:e.id,title:e.title,content:e.content.substring(0,500)+"...",relevanceScore:e.relevanceScore,source:e.source})),materialResults:(e.results.materialKnowledge||[]).map(e=>({id:e.materialId,title:e.materialName,content:e.extractedKnowledge,relevanceScore:e.relevanceScore,source:"material_knowledge"})),totalResults:(e.results.knowledgeBase||[]).length+(e.results.materialKnowledge||[]).length,searchTime:(null===(m=e.performance)||void 0===m?void 0:m.totalTime)||0},console.log("✅ RAG search completed:",y),g.ragResults=y)}catch(e){console.warn("⚠️ RAG search failed, continuing without:",e)}let f=null;if(H.useVisualSearch&&Z.some(e=>e.type.startsWith("image/")))try{for(let t of(console.log("\uD83D\uDC41️ Performing visual search..."),Z.filter(e=>e.type.startsWith("image/"))))try{let a=E.n.getInstance(),s=(await a.executeSupabaseFunction("visual-search",{user_id:e.user.id,search_type:T.trim()?"hybrid":"visual",query_text:T.trim()||"Find similar materials",image_data:{name:t.name,type:t.type,url:t.url,preview:t.preview},search_filters:{},similarity_threshold:.75,max_results:20,session_id:F})).data;if((null==s?void 0:s.success)&&(null==s?void 0:s.results)&&s.results.length>0){f={searchId:s.search_id||crypto.randomUUID(),matches:s.results.map(e=>({id:e.material_id,name:e.material_name||e.name,description:e.description,similarity_score:e.similarity_score,llama_analysis:e.llama_analysis,visual_features:e.visual_features,thumbnail_url:e.thumbnail_url})),search_execution_time_ms:s.search_execution_time_ms||0,total_results:s.results.length,query_analysis:s.query_analysis||{}},console.log("✅ Visual search completed:",f),g.visualSearchResults=f||null,X(f);break}}catch(e){console.warn("⚠️ Visual search failed for ".concat(t.name,":"),e)}}catch(e){console.warn("⚠️ Visual search failed, continuing without:",e)}let x=null,v=null;if(H.enableRAG&&H.primary&&H.fallback){console.log("\uD83D\uDD04 Using Hybrid AI Service...");try{let e=await U.processRequest({prompt:T,model:H.primary,type:"general",maxRetries:2,minimumScore:.7});if(e.success)x={success:!0,response:e.data||"Processed using hybrid AI models",coordination_summary:"Processed using hybrid AI models with fallback support",coordinated_result:{content:e.data||"Processed using hybrid AI models",recommendations:[],materials:[]},task_id:crypto.randomUUID(),total_processing_time_ms:e.total_processing_time_ms||0,overall_confidence:e.final_score||.7,agent_executions:e.attempts||[]},v=null;else throw Error("Hybrid AI failed: No successful response")}catch(s){console.warn("⚠️ Hybrid AI failed, falling back to standard Material Agent:",s);let t=E.n.getInstance(),a=await t.executeSupabaseFunction("material-agent-orchestrator",{user_id:e.user.id,task_type:"comprehensive_design",input_data:{query:T,sessionId:F,context:g,hybridConfig:H,attachments:Z.length>0?Z:void 0}});x=a.data,v=(null===(h=a.error)||void 0===h?void 0:h.message)||null}}else{console.log("\uD83E\uDD16 Using standard Material Agent...");let t=E.n.getInstance(),a=await t.executeSupabaseFunction("material-agent-orchestrator",{user_id:e.user.id,task_type:"comprehensive_design",input_data:{query:T,sessionId:F,context:g,hybridConfig:H,attachments:Z.length>0?Z:void 0}});x=a.data,v=(null===(p=a.error)||void 0===p?void 0:p.message)||null}if(v)throw console.error("Material Agent function error:",v),Error(v||"Failed to get AI response");if(!x||!x.success)throw Error((null==x?void 0:x.error_message)||(null==x?void 0:x.error)||"AI processing failed");let w={success:!0,response:(null===(t=x.coordinated_result)||void 0===t?void 0:t.content)||(null===(a=x.coordinated_result)||void 0===a?void 0:a.analysis)||String(x.coordinated_result)||"Analysis completed successfully",thinking:x.coordination_summary||"Task processed through Material Agent coordination",suggestions:(null===(s=x.coordinated_result)||void 0===s?void 0:s.recommendations)||[],materials:(null===(r=x.coordinated_result)||void 0===r?void 0:r.materials)||[],metadata:{taskId:x.task_id,processingTime:x.total_processing_time_ms,overallConfidence:x.overall_confidence,agentCount:(null===(i=x.agent_executions)||void 0===i?void 0:i.length)||0,crewAI:!0}};console.log("Material Agent response:",w);let _=null;if(H.enable3DGeneration&&x.response)try{console.log("\uD83C\uDFA8 Attempting 3D generation...");let e=String(x.response||"");if(["interior","room","space","design","layout","furniture","decor"].some(t=>e.toLowerCase().includes(t))){let e=await P.generate3D({prompt:T,room_type:"general",style:"modern",specific_materials:[]});e.success&&(_={generationId:e.generation_id,imageUrls:e.image_urls,parsedRequest:e.parsed_request,matchedMaterials:e.matched_materials,qualityAssessment:e.quality_assessment,processingTime:e.processing_time_ms},console.log("✅ 3D generation completed:",_))}}catch(e){console.warn("⚠️ 3D generation failed:",e)}let b={id:crypto.randomUUID(),role:"assistant",content:w.response||"I processed your request successfully.",timestamp:new Date,thinking:String(w.thinking||""),suggestions:w.suggestions||[],materials:w.materials||[],metadata:{...(null===(n=w.metadata)||void 0===n?void 0:n.taskId)&&{taskId:w.metadata.taskId},processingTime:null===(o=w.metadata)||void 0===o?void 0:o.processingTime,overallConfidence:null===(l=w.metadata)||void 0===l?void 0:l.overallConfidence,agentCount:null===(c=w.metadata)||void 0===c?void 0:c.agentCount,crewAI:null===(d=w.metadata)||void 0===d?void 0:d.crewAI,..._&&{has3DContent:!0,designGeneration:_}}};R(e=>[...e,b]),V([]),C({title:"AI Response Generated",description:"Found ".concat(((null===(u=x.coordinated_result)||void 0===u?void 0:u.materials)||[]).length," relevant materials"),duration:3e3})}catch(t){console.error("Error sending message:",t);let e={id:crypto.randomUUID(),role:"system",content:"❌ Error: ".concat(t instanceof Error?t.message:"Failed to process request"),timestamp:new Date};R(t=>[...t,e]),C({title:"Error",description:t instanceof Error?t.message:"Failed to get AI response",variant:"destructive"})}finally{G(!1)}},et=e=>{q(e)},ea=e=>{t&&e.id&&t(e.id)};return(0,s.jsxs)("div",{className:"w-full max-w-4xl mx-auto space-y-4",children:[(0,s.jsx)(j.Zb,{children:(0,s.jsx)(j.Ol,{className:"pb-3",children:(0,s.jsxs)(j.ll,{className:"flex items-center gap-2",children:[(0,s.jsx)(n,{className:"h-6 w-6 text-primary"}),"Material Agent Research Assistant",(0,s.jsxs)(A.C,{className:"ml-auto border border-border bg-background text-foreground",children:[(0,s.jsx)(o.Z,{className:"h-3 w-3 mr-1"}),"AI-Powered"]})]})})}),(0,s.jsx)(j.Zb,{className:"min-h-[500px] max-h-[600px] overflow-hidden",children:(0,s.jsx)(j.aY,{className:"p-0",children:(0,s.jsxs)("div",{className:"h-[500px] overflow-y-auto p-4 space-y-4",children:[M.map(e=>(0,s.jsx)("div",{className:"flex gap-3 ".concat("user"===e.role?"justify-end":"justify-start"),children:(0,s.jsxs)("div",{className:"flex gap-3 max-w-[80%] ".concat("user"===e.role?"flex-row-reverse":"flex-row"),children:[(0,s.jsx)("div",{className:"flex-shrink-0",children:"user"===e.role?(0,s.jsx)("div",{className:"w-8 h-8 rounded-full bg-primary flex items-center justify-center",children:(0,s.jsx)(l.Z,{className:"h-4 w-4 text-primary-foreground"})}):"system"===e.role?(0,s.jsx)("div",{className:"w-8 h-8 rounded-full bg-destructive flex items-center justify-center",children:(0,s.jsx)(c,{className:"h-4 w-4 text-destructive-foreground"})}):(0,s.jsx)("div",{className:"w-8 h-8 rounded-full bg-secondary flex items-center justify-center",children:(0,s.jsx)(n,{className:"h-4 w-4 text-secondary-foreground"})})}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsxs)("div",{className:"p-3 rounded-lg ".concat("user"===e.role?"bg-primary text-primary-foreground":"system"===e.role?"bg-destructive/10 text-destructive border border-destructive/20":"bg-muted"),children:[(0,s.jsx)("p",{className:"whitespace-pre-wrap",children:e.content}),e.thinking&&(0,s.jsxs)("details",{className:"mt-2",children:[(0,s.jsxs)("summary",{className:"cursor-pointer text-sm opacity-70 flex items-center gap-1",children:[(0,s.jsx)(d.Z,{className:"h-3 w-3"}),"AI Thinking Process"]}),(0,s.jsx)("div",{className:"mt-2 p-2 bg-background/50 rounded text-sm",children:e.thinking})]})]}),e.materials&&e.materials.length>0&&(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsxs)("div",{className:"flex items-center gap-1 text-sm text-muted-foreground",children:[(0,s.jsx)(u.Z,{className:"h-3 w-3"}),"Found Materials (",e.materials.length,")"]}),(0,s.jsx)("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-2",children:e.materials.slice(0,4).map((e,t)=>(0,s.jsxs)("div",{onClick:()=>ea(e),className:"p-2 border rounded cursor-pointer hover:bg-muted/50 transition-colors",children:[(0,s.jsx)("div",{className:"font-medium text-sm",children:e.name}),(0,s.jsx)("div",{className:"text-xs text-muted-foreground truncate",children:e.description}),e.category&&(0,s.jsx)(A.C,{className:"mt-1 text-xs border border-border bg-background text-foreground",children:e.category})]},t))}),e.materials.length>4&&(0,s.jsxs)("div",{className:"text-xs text-muted-foreground",children:["+",e.materials.length-4," more materials found"]})]}),W&&W.matches.length>0&&(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsxs)("div",{className:"flex items-center gap-1 text-sm text-muted-foreground",children:[(0,s.jsx)(m.Z,{className:"h-3 w-3"}),"Visual Search Results (",W.total_results," found)"]}),(0,s.jsx)("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-2",children:W.matches.slice(0,6).map(e=>(0,s.jsxs)("div",{onClick:()=>ea({id:e.id,name:e.name,description:e.description||"No description available",relevanceScore:e.similarity_score,source:"visual_search"}),className:"p-2 border rounded cursor-pointer hover:bg-muted/50 transition-colors",children:[e.thumbnail_url&&(0,s.jsx)("img",{src:e.thumbnail_url,alt:e.name,className:"w-full h-16 object-cover rounded mb-1"}),(0,s.jsx)("div",{className:"font-medium text-sm",children:e.name}),(0,s.jsx)("div",{className:"text-xs text-muted-foreground truncate",children:e.description}),(0,s.jsx)("div",{className:"flex items-center gap-1 mt-1",children:(0,s.jsxs)(A.C,{className:"text-xs border border-blue-200 bg-blue-50 text-blue-700",children:[(0,s.jsx)(m.Z,{className:"h-2 w-2 mr-1"}),Math.round(100*e.similarity_score),"% visual match"]})})]},e.id))}),W.matches.length>6&&(0,s.jsxs)("div",{className:"text-xs text-muted-foreground",children:["+",W.matches.length-6," more visual matches found"]}),(0,s.jsxs)("div",{className:"text-xs text-muted-foreground",children:["Visual search completed in ",W.search_execution_time_ms,"ms"]})]}),e.suggestions&&e.suggestions.length>0&&(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsxs)("div",{className:"flex items-center gap-1 text-sm text-muted-foreground",children:[(0,s.jsx)(h.Z,{className:"h-3 w-3"}),"Suggestions"]}),(0,s.jsx)("div",{className:"flex flex-wrap gap-2",children:e.suggestions.map((e,t)=>(0,s.jsx)(k.z,{onClick:()=>et(e),className:"text-xs h-7",children:e},t))})]}),(0,s.jsx)("div",{className:"text-xs text-muted-foreground",children:e.timestamp.toLocaleTimeString()})]})]})},e.id)),z&&(0,s.jsxs)("div",{className:"flex gap-3 justify-start",children:[(0,s.jsx)("div",{className:"w-8 h-8 rounded-full bg-secondary flex items-center justify-center",children:(0,s.jsx)(n,{className:"h-4 w-4 text-secondary-foreground"})}),(0,s.jsx)("div",{className:"bg-muted p-3 rounded-lg",children:(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)(p.Z,{className:"h-4 w-4 animate-spin"}),(0,s.jsx)("span",{children:"AI is thinking..."})]})})]}),(0,s.jsx)("div",{ref:J})]})})}),(0,s.jsx)(j.Zb,{children:(0,s.jsxs)(j.aY,{className:"p-4",children:[(0,s.jsxs)("div",{className:"space-y-3",children:[Z.length>0&&(0,s.jsx)("div",{className:"flex flex-wrap gap-2 p-2 bg-muted rounded-md",children:Z.map(e=>(0,s.jsxs)("div",{className:"flex items-center gap-2 bg-background rounded px-2 py-1 text-sm",children:[e.type.startsWith("image/")?(0,s.jsx)(g,{className:"h-3 w-3"}):(0,s.jsx)(y.Z,{className:"h-3 w-3"}),(0,s.jsx)("span",{className:"truncate max-w-[120px]",children:e.name}),(0,s.jsx)(k.z,{onClick:()=>$(e.id),className:"h-4 w-4 p-0 bg-transparent hover:bg-destructive hover:text-destructive-foreground",children:(0,s.jsx)(f.Z,{className:"h-3 w-3"})})]},e.id))}),L&&(0,s.jsxs)("div",{className:"p-3 bg-muted rounded-md space-y-3",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsxs)("h4",{className:"text-sm font-medium flex items-center gap-2",children:[(0,s.jsx)(x,{className:"h-4 w-4"}),"AI Configuration"]}),(0,s.jsx)(k.z,{onClick:()=>O(!1),className:"h-6 w-6 p-0 bg-transparent hover:bg-accent hover:text-accent-foreground",children:(0,s.jsx)(f.Z,{className:"h-3 w-3"})})]}),(0,s.jsxs)("div",{className:"grid grid-cols-2 gap-3 text-xs",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-muted-foreground mb-1",children:"Primary Model"}),(0,s.jsxs)("select",{value:H.primary,onChange:e=>B(t=>({...t,primary:e.target.value})),className:"w-full p-1 rounded border bg-background",children:[(0,s.jsx)("option",{value:"openai",children:"OpenAI GPT"}),(0,s.jsx)("option",{value:"claude",children:"Claude"}),(0,s.jsx)("option",{value:"vertex",children:"Vertex AI"})]})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-muted-foreground mb-1",children:"Fallback Model"}),(0,s.jsxs)("select",{value:H.fallback,onChange:e=>B(t=>({...t,fallback:e.target.value})),className:"w-full p-1 rounded border bg-background",children:[(0,s.jsx)("option",{value:"openai",children:"OpenAI GPT"}),(0,s.jsx)("option",{value:"claude",children:"Claude"}),(0,s.jsx)("option",{value:"vertex",children:"Vertex AI"})]})]}),(0,s.jsxs)("div",{className:"col-span-2",children:[(0,s.jsxs)("label",{className:"block text-muted-foreground mb-1",children:["Temperature: ",H.temperature]}),(0,s.jsx)("input",{type:"range",min:"0",max:"1",step:"0.1",value:H.temperature,onChange:e=>B(t=>({...t,temperature:parseFloat(e.target.value)})),className:"w-full"})]}),(0,s.jsxs)("div",{className:"col-span-2 flex items-center gap-2",children:[(0,s.jsx)("input",{type:"checkbox",id:"enable-rag",checked:H.enableRAG,onChange:e=>B(t=>({...t,enableRAG:e.target.checked})),className:"rounded"}),(0,s.jsx)("label",{htmlFor:"enable-rag",className:"text-muted-foreground",children:"Enable Knowledge Base Search"})]}),(0,s.jsxs)("div",{className:"col-span-2 flex items-center gap-2",children:[(0,s.jsx)("input",{type:"checkbox",id:"enable-3d",checked:H.enable3DGeneration,onChange:e=>B(t=>({...t,enable3DGeneration:e.target.checked})),className:"rounded"}),(0,s.jsx)("label",{htmlFor:"enable-3d",className:"text-muted-foreground",children:"Enable 3D Generation"})]})]})]}),(0,s.jsxs)("div",{className:"flex gap-2",children:[(0,s.jsx)(N.I,{value:T,onChange:e=>q(e.target.value),onKeyPress:e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),ee())},placeholder:"Ask me about materials, properties, applications, or design ideas...",disabled:z,className:"flex-1"}),(0,s.jsx)(k.z,{type:"button",onClick:()=>{var e;return null===(e=Q.current)||void 0===e?void 0:e.click()},disabled:z,title:"Attach files",children:(0,s.jsx)(v,{className:"h-4 w-4"})}),(0,s.jsx)(k.z,{type:"button",onClick:()=>O(!L),disabled:z,title:"AI Settings",children:(0,s.jsx)(w.Z,{className:"h-4 w-4"})}),(0,s.jsx)(k.z,{onClick:ee,disabled:z||!T.trim(),className:"h-8 w-8 p-0",children:z?(0,s.jsx)(p.Z,{className:"h-4 w-4 animate-spin"}):(0,s.jsx)(_,{className:"h-4 w-4"})})]}),(0,s.jsx)("input",{ref:Q,type:"file",multiple:!0,accept:"image/*,.pdf,.txt,.doc,.docx",onChange:e=>{let t=e.target.files;t&&(Array.from(t).forEach(e=>{if(e.size>10485760){C({title:"File too large",description:"".concat(e.name," is larger than 10MB"),variant:"destructive"});return}if(!["image/jpeg","image/png","image/gif","image/webp","application/pdf","text/plain","text/csv"].includes(e.type)){C({title:"Unsupported file type",description:"".concat(e.name," is not a supported file type"),variant:"destructive"});return}let t={id:crypto.randomUUID(),name:e.name,type:e.type,size:e.size,url:URL.createObjectURL(e)};if(e.type.startsWith("image/")){let a=new FileReader;a.onload=e=>{var a;t.preview=null===(a=e.target)||void 0===a?void 0:a.result,V(e=>[...e,t])},a.readAsDataURL(e)}else V(e=>[...e,t])}),Q.current&&(Q.current.value=""))},className:"hidden"})]}),(0,s.jsxs)("div",{className:"flex justify-between items-center mt-3 text-xs text-muted-foreground",children:[(0,s.jsx)("span",{children:"Press Enter to send, Shift+Enter for new line"}),(0,s.jsxs)("span",{children:["Session: ",F.substring(0,8),"..."]})]})]})}),(0,s.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-3",children:[(0,s.jsxs)(k.z,{onClick:a,className:"justify-start gap-2",children:[(0,s.jsx)(b.Z,{className:"h-4 w-4"}),"Browse Mood Boards"]}),(0,s.jsxs)(k.z,{onClick:i,className:"justify-start gap-2",children:[(0,s.jsx)(o.Z,{className:"h-4 w-4"}),"3D Generation"]}),(0,s.jsxs)(k.z,{onClick:()=>et("Show me the latest material trends"),className:"justify-start gap-2",children:[(0,s.jsx)(h.Z,{className:"h-4 w-4"}),"Material Trends"]})]})]})};var G=()=>(0,s.jsx)("div",{className:"min-h-screen bg-background p-6",children:(0,s.jsxs)("div",{className:"max-w-6xl mx-auto space-y-6",children:[(0,s.jsxs)("div",{className:"text-center space-y-2",children:[(0,s.jsx)("h1",{className:"text-3xl font-bold",children:"AI Search Hub"}),(0,s.jsx)("p",{className:"text-muted-foreground",children:"Intelligent material research powered by Material Agent Orchestrator"})]}),(0,s.jsx)(z,{onMaterialSelect:e=>{console.log("Material selected:",e),window.location.href="/catalog?material=".concat(e)},onNavigateToMoodboard:()=>{window.location.href="/moodboard"},onNavigateTo3D:()=>{window.location.href="/3d"}})]})})}},function(e){e.O(0,[339,707,338,888,774,179],function(){return e(e.s=6654)}),_N_E=e.O()}]);